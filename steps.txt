# CI/CD Pipeline with Jenkins and Ansible

## 1Ô∏è‚É£ **Setup SSH from Worker2 to Master**
### **On Worker2:**
1. **Generate SSH Key** (if not already created):
   ```bash
   ssh-keygen -t rsa -b 4096 -f ~/.ssh/id_rsa -N ""
   ```
2. **Copy Public Key to Master:**
   ```bash
   ssh-copy-id master@<MASTER_IP>
   ```
3. **Verify SSH Connection:**
   ```bash
   ssh master@<MASTER_IP>
   ```
   Ensure no password is required.

---

## 2Ô∏è‚É£ **Configure Jenkins Permissions**
### **On Worker2:**
1. **Allow Jenkins to Run Ansible Without Password:**
   ```bash
   sudo visudo
   ```
2. **Add This Line at the End:**
   ```bash
   jenkins ALL=(ALL) NOPASSWD: ALL
   ```

3. **Allow SSH for Jenkins User:**
   ```bash
   sudo su - jenkins
   ssh-keygen -t rsa -b 4096
   ssh-copy-id master@<MASTER_IP>
   ```

4. **Disable Host Key Verification for Jenkins:**
   ```bash
   echo "StrictHostKeyChecking no" >> ~/.ssh/config
   ```

---

## 3Ô∏è‚É£ **Setup Ansible Inventory**
Create `inventory.ini` in the project directory:
```ini
[webservers]
master ansible_host=<MASTER_IP> ansible_user=master ansible_ssh_private_key_file=~/.ssh/id_rsa
```

---

## 4Ô∏è‚É£ **Create Ansible Playbook (deploy_app.yml)**
```yaml
- name: Deploy Application
  hosts: all
  become: yes

  tasks:
    - name: Copy App Files
      copy:
        src: /var/lib/jenkins/workspace/ansible_pipeline/app.py
        dest: /var/www/html/
        owner: www-data
        group: www-data
        mode: '0755'
```

---

## 5Ô∏è‚É£ **Create Jenkins Pipeline (Jenkinsfile)**
```groovy
pipeline {
    agent any
    stages {
        stage('Pull Code') {
            steps {
                git url: 'https://github.com/KPkm25/jenkins_assessment.git', branch: 'main'
            }
        }
        stage('Run Ansible Playbook') {
            steps {
                sh 'ansible-playbook -i inventory.ini deploy_app.yml'
            }
        }
    }
}
```

---

## 6Ô∏è‚É£ **Run the Jenkins Job**
1. **Go to Jenkins Dashboard ‚Üí New Item ‚Üí Pipeline**
2. **Paste the `Jenkinsfile` content**
3. **Run the Pipeline**
4. **Verify Deployment:**
   ```bash
   curl http://<MASTER_IP>:5000
   ```

---

## ‚úÖ **Troubleshooting**
- **Host Key Verification Failed:**
  ```bash
  ssh-keyscan <MASTER_IP> >> ~/.ssh/known_hosts
  ```
- **File Not Found Error:** Ensure the correct path is used in `deploy_app.yml`.
- **Jenkins Permission Issues:** Ensure Jenkins user has `NOPASSWD` sudo access.

---

This document covers the full setup for a **Jenkins + Ansible CI/CD pipeline**. üöÄ

